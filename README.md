# Price Tracker Application

This is a price tracking application with a FastAPI backend and a Flutter frontend.

## Project Structure

```
.
├── backend/
│   ├── app/
│   │   ├── models/
│   │   │   ├── __init__.py
│   │   │   ├── notification_queue.py
│   │   │   ├── price_history.py
│   │   │   ├── product.py
│   │   │   └── user.py
│   │   ├── routes/
│   │   │   ├── auth.py
│   │   │   └── products.py
│   │   ├── scrapers/
│   │   │   ├── base_scraper.py
│   │   │   ├── generic_scraper.py
│   │   │   └── scraper_factory.py
│   │   ├── tasks/
│   │   │   └── tasks.py
│   │   ├── utils/
│   │   │   ├── database.py
│   │   │   ├── error_handler.py
│   │   │   ├── logging.py
│   │   │   └── security.py
│   │   ├── celery_app.py
│   │   ├── main.py
│   │   └── schemas.py
│   └── venv/
│   └── .env
├── frontend/
│   ├── lib/
│   │   ├── screens/
│   │   │   ├── add_product_screen.dart
│   │   │   ├── home_screen.dart
│   │   │   ├── login_screen.dart
│   │   │   └── register_screen.dart
│   │   └── main.dart
│   └── assets/
│   └── pubspec.yaml
│   └── ... (other Flutter files)
└── README.md
```

## Features

### User Authentication
- User registration, login, and logout.
- JWT-based authentication.

### Product Tracking
- Add product links for price tracking.
- Scrapes product information (name, price, image, site).
- Users can set a target price for products.

### Price Tracking Engine
- Automated price checking every 6 hours using Celery.
- Records price history.
- Logs price drop notifications (on-screen notifications are planned for the frontend).

## Setup and Running

### 1. Backend Setup

Navigate to the `backend` directory:
```bash
cd backend
```

**Create and Activate Virtual Environment:**
```bash
python3 -m venv venv
source venv/bin/activate
```

**Install Dependencies:**
```bash
pip install -r requirements.txt
```

**Environment Variables:**
Create a `.env` file in the `backend` directory with the following content:
```
DATABASE_URL=sqlite:///./test.db
SECRET_KEY=a_super_secret_key
REDIS_URL=redis://localhost:6379/0
```

**Run FastAPI Server:**
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```
For background execution:
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 &
```

**Run Celery Worker:**
Ensure Redis server is running (`brew services start redis` on macOS if installed via Homebrew).
```bash
celery -A app.celery_app worker --loglevel=info
```

**Run Celery Beat (Scheduler):**
```bash
celery -A app.celery_app beat --loglevel=info
```

### 2. Frontend Setup (Flutter)

Navigate to the `frontend` directory:
```bash
cd frontend
```

**Get Dependencies:**
```bash
flutter pub get
```

**Run Flutter App:**
```bash
flutter run
```

## Development Notes

-   **Database:** Currently uses SQLite for simplicity. For production, consider PostgreSQL.
-   **Authentication Hashing:** The password hashing scheme has been updated from `bcrypt` to `pbkdf2_sha256` using `passlib` for improved compatibility and to resolve environment-specific issues.
-   **Scrapers:** The `generic_scraper.py` is a basic implementation. More robust, site-specific scrapers will be needed for reliable price tracking. An improved mocking strategy has been implemented for testing to prevent actual network calls.
-   **Notifications:** Currently, price drop notifications are logged in the backend. Frontend on-screen notifications are planned. Firebase Cloud Messaging (FCM) integration was postponed.
-   **Authentication:** JWT tokens are generated but not yet stored or automatically sent with subsequent requests from the frontend. This will need to be implemented.
-   **User Products:** The `user_id` in `NotificationQueue` and the logic for associating products with specific users in `check_prices` task needs to be made dynamic.

---
*This README was generated by an AI assistant.*